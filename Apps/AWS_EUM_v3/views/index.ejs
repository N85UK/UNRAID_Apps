<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS End User Messaging v3.0</title>
    <link rel="stylesheet" href="http://10.0.2.11/css/style.css?v=<%= Date.now() %>" type="text/css">
    <script>
        console.log('üé® CSS Link URL:', 'http://10.0.2.11/css/style.css?v=<%= Date.now() %>');
        // Check if CSS loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM loaded, checking CSS...');
            var link = document.querySelector('link[rel="stylesheet"]');
            if (link) {
                console.log('üîó CSS link found:', link.href);
            } else {
                console.log('‚ùå No CSS link found');
            }
        });
    </script>
    <style>
        /* Inline fallback CSS to ensure basic styling */
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; margin-bottom: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AWS End User Messaging v3.0</h1>
            <p>Enhanced SMS messaging with AWS integration</p>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-label">AWS:</span>
                    <span class="status-value <%= config.aws_configured ? 'connected' : 'disconnected' %>">
                        <%= config.aws_configured ? 'Connected' : 'Not Configured' %>
                    </span>
                </div>
                <% if (config.aws_configured) { %>
                    <div class="status-item">
                        <span class="status-label">Region:</span>
                        <span class="status-value"><%= config.aws_region %></span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">AWS Numbers:</span>
                        <span class="status-value"><%= config.aws_originators || 0 %></span>
                        <% if (config.aws_phone_numbers > 0 || config.aws_sender_ids > 0) { %>
                            <small>(<%= config.aws_phone_numbers || 0 %> phone, <%= config.aws_sender_ids || 0 %> sender ID)</small>
                        <% } %>
                    </div>
                    <% if (config.manual_originators > 0) { %>
                        <div class="status-item">
                            <span class="status-label">Manual:</span>
                            <span class="status-value"><%= config.manual_originators %></span>
                        </div>
                    <% } %>
                <% } %>
            </div>
        </header>

        <main>
            <% if (!config.aws_configured) { %>
                <section class="config-warning">
                    <h2>‚ö†Ô∏è AWS Configuration Required</h2>
                    <p>Please configure your AWS credentials in the UNRAID template settings:</p>
                    <ul>
                        <li>AWS Access Key ID</li>
                        <li>AWS Secret Access Key</li>
                        <li>AWS Region</li>
                    </ul>
                    <p>Once configured, restart the container to connect to AWS.</p>
                </section>
            <% } else { %>
                <section class="sms-form">
                    <div class="form-header">
                        <h2>Send SMS Message</h2>
                        <button id="refreshOriginators" class="btn-refresh" title="Refresh phone numbers from AWS">
                            üîÑ Refresh Numbers
                        </button>
                    </div>
                    
                    <form id="smsForm">
                        <div class="form-group">
                            <label for="originator">Phone Number / Originator:</label>
                            <select id="originator" name="originator" required>
                                <% if (Object.keys(originators).length === 0) { %>
                                    <% if (config.aws_configured) { %>
                                        <option value="">No phone numbers found - Check AWS credentials</option>
                                    <% } else { %>
                                        <option value="">Configure AWS credentials to load phone numbers</option>
                                    <% } %>
                                <% } else { %>
                                    <option value="">Select a phone number...</option>
                                    <% Object.keys(originators).forEach(label => { %>
                                        <option value="<%= originators[label] %>"><%= label %></option>
                                    <% }); %>
                                <% } %>
                            </select>
                            <button type="button" id="refreshOriginators" class="refresh-btn">
                                üîÑ Refresh Numbers
                            </button>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumber">Destination Phone Number:</label>
                            <input type="tel" id="phoneNumber" name="phoneNumber"
                                   placeholder="+447700900000 or +1234567890" required>
                            <small>Include country code (e.g., +44 for UK, +1 for US)</small>
                        </div>

                        <div class="form-group">
                            <label for="message">Message:</label>
                            <textarea id="message" name="message" rows="6"
                                      placeholder="Enter your message... Longer messages will be automatically split into multiple SMS segments."
                                      required></textarea>
                            <div class="message-info">
                                <div class="char-count">
                                    <span id="charCount">0 characters</span>
                                </div>
                                <div class="message-details">
                                    <span id="segmentInfo">1 SMS segment</span>
                                    <span id="costEstimate" class="cost-info"></span>
                                </div>
                            </div>
                        </div>

                        <button type="submit" id="sendBtn" class="btn-primary">
                            <span class="btn-text">Send SMS</span>
                            <span class="btn-loading" style="display: none;">Sending...</span>
                        </button>
                    </form>
                </section>

                <section class="message-preview" id="messagePreview" style="display: none;">
                    <h3>Message Preview</h3>
                    <div class="preview-content">
                        <div class="preview-segments" id="previewSegments"></div>
                    </div>
                </section>
            <% } %>

            <section class="message-history">
                <div class="history-header">
                    <h2>Message History</h2>
                    <button id="refreshHistory" class="btn-refresh">üîÑ Refresh</button>
                </div>
                
                <div id="history">
                    <% if (history.length === 0) { %>
                        <p class="no-history">No messages sent yet.</p>
                    <% } else { %>
                        <% history.forEach(msg => { %>
                            <div class="history-item">
                                <div class="history-header">
                                    <span class="timestamp"><%= new Date(msg.timestamp).toLocaleString() %></span>
                                    <span class="originator"><%= msg.originator %></span>
                                </div>
                                <div class="phone-number">üì± <%= msg.phoneNumber %></div>
                                <div class="message-body"><%= msg.message %></div>
                                <div class="message-meta">
                                    <% if (msg.messageId) { %>
                                        <span class="message-id">ID: <%= msg.messageId %></span>
                                    <% } %>
                                    <% if (msg.messageInfo) { %>
                                        <span class="message-segments">
                                            <%= msg.messageInfo.segments %> segment<%= msg.messageInfo.segments > 1 ? 's' : '' %>
                                        </span>
                                        <span class="message-length">
                                            <%= msg.messageInfo.length %> chars
                                        </span>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
            </section>
        </main>

        <footer>
            <div class="footer-info">
                <p>AWS End User Messaging v<%= config.version || '2.0' %> | Enhanced with UNRAID integration</p>
                <% if (config.has_latest_features) { %>
                    <p><small>‚úÖ Latest features enabled | Build: <%= config.build_timestamp || 'Unknown' %></small></p>
                <% } else { %>
                    <p><small>‚ö†Ô∏è  Running older version - update container for latest features</small></p>
                <% } %>
                <p>Longer messages are automatically split into SMS segments</p>
            </div>
        </footer>
    </div>

    <div id="notification" class="notification" style="display: none;"></div>

    <script src="/js/app.js"></script>
</body>
</html>