<?xml version="1.0"?>
<Container version="2">
  <Name>AWS_EUM_X</Name>
  <Repository>ghcr.io/n85uk/aws-eum-x:latest</Repository>
  <Registry>https://ghcr.io/n85uk/aws-eum-x</Registry>
  <Network>bridge</Network>
  <Privileged>false</Privileged>
  <Support>https://github.com/N85UK/UNRAID_Apps/issues</Support>
  <Project>https://github.com/N85UK/UNRAID_Apps/tree/main/Apps/AWS_EUM_X</Project>
  <Overview>
AWS End User Messaging X (EUM X) - v1.0.0

Modern, secure, observable SMS messaging interface for AWS Pinpoint SMS and Voice v2.

âœ¨ Key Features:
â€¢ First-run wizard for guided setup
â€¢ Automatic AWS phone number and sender ID discovery
â€¢ Structured JSON logging with automatic secret redaction
â€¢ Health and readiness probes for monitoring
â€¢ DryRun support for safe testing without sending messages
â€¢ Message part estimator (GSM-7 and UCS-2 encoding detection)
â€¢ MPS-aware rate limiting with configurable queue
â€¢ SNS webhook signature verification (planned)
â€¢ Export/import configuration (secrets excluded)
â€¢ Production-ready observability

ðŸ”’ Security Highlights:
â€¢ Runs as non-root user (appuser)
â€¢ Secrets never logged in plain text
â€¢ Configurable CSP for custom networks
â€¢ E.164 phone number validation
â€¢ IAM least-privilege policy examples included

ðŸ“Š Observability:
â€¢ /health - Liveness probe with version and uptime
â€¢ /ready - Readiness probe with AWS connectivity check
â€¢ /probe/aws - Dedicated AWS connectivity test
â€¢ Structured logs (JSON) with pino
â€¢ Support bundle export for troubleshooting

ðŸš€ Recent Updates:
â€¢ v1.0.0 - Initial release with audit-driven improvements
â€¢ Modular architecture with message queue and backoff
â€¢ Message parts calculation and cost estimation
â€¢ Better error messages and validation

Usage:
1. Install from Community Apps
2. Configure AWS credentials (IAM user with Pinpoint permissions)
3. Complete first-run wizard
4. Test with DryRun before sending real messages

Volume Setup:
â€¢ Container Path: /app/data (required)
â€¢ Host Path: /mnt/user/appdata/aws-eum-x
â€¢ Stores message history and configuration (secrets excluded)

Network Configuration:
â€¢ For custom bridge networks (br0.x): Set DISABLE_CSP=true
â€¢ Default port: 80 (map to any available host port)
  </Overview>
  <Category>Network:Management Tools:</Category>
  <WebUI>http://[IP]:[PORT:80]/</WebUI>
  <Icon>https://raw.githubusercontent.com/N85UK/UNRAID_Apps/main/Apps/AWS_EUM_X/icons/aws-eum-x-512.png</Icon>
  <ExtraParams>--restart unless-stopped --memory=512m --cpu-shares=1024</ExtraParams>
  <Description>AWS EUM X v1.0.0 - Modern, secure, observable SMS interface with first-run wizard and structured logging</Description>

  <!-- ==================== REQUIRED CONFIGURATION ==================== -->
  
  <!-- Paths -->
  <Config Name="AppData" Target="/app/data" Default="/mnt/user/appdata/aws-eum-x" Mode="rw" Description="Container data directory - MUST use /app/data for proper permissions. Stores message history and configuration." Type="Path" Display="always" Required="true" Mask="false"/>

  <!-- Ports -->
  <Config Name="Web UI Port" Target="80" Default="8080" Mode="tcp" Description="Host port for web UI (maps to container port 80). Choose any available port on your Unraid server." Type="Port" Display="always" Required="true" Mask="false"/>

  <!-- ==================== AWS CREDENTIALS (Required) ==================== -->
  
  <Config Name="AWS Access Key ID" Target="AWS_ACCESS_KEY_ID" Default="" Mode="" Description="[AWS IAM Access Key] - Required permission: pinpoint-sms-voice-v2:SendTextMessage, DescribePhoneNumbers, DescribeSenderIds. Use short-lived credentials where possible." Type="Variable" Display="always" Required="true" Mask="true"/>
  
  <Config Name="AWS Secret Access Key" Target="AWS_SECRET_ACCESS_KEY" Default="" Mode="" Description="[AWS IAM Secret Key] - Secret key for the above Access Key ID. NEVER share this or include in screenshots. Automatically redacted from logs." Type="Variable" Display="always" Required="true" Mask="true"/>
  
  <Config Name="AWS Region" Target="AWS_REGION" Default="us-east-1" Mode="" Description="[AWS Region] - AWS region where your Pinpoint SMS resources are located (e.g., us-east-1, eu-west-2, ap-southeast-1). Must match where your phone numbers/sender IDs are provisioned." Type="Variable" Display="always" Required="true" Mask="false"/>

  <!-- ==================== NETWORK & SECURITY ==================== -->
  
  <Config Name="Disable CSP" Target="DISABLE_CSP" Default="true" Mode="" Description="[Content Security Policy] - Set to 'true' for custom bridge networks (br0.x) that may block external resources. Set to 'false' for strict CSP when using standard bridge mode. Recommended: true for most Unraid setups." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Network Host" Target="NETWORK_HOST" Default="*" Mode="" Description="[CSP Network Allow] - Network origin to allow in CSP when CSP is enabled. Use '*' for permissive or specify your network (e.g., 'http://10.0.2.0/24'). Only relevant if DISABLE_CSP=false." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== LOGGING & OBSERVABILITY ==================== -->
  
  <Config Name="Log Level" Target="LOG_LEVEL" Default="info" Mode="" Description="[Logging Level] - Log verbosity: 'error', 'warn', 'info', 'debug', 'trace'. Use 'info' for normal operation, 'debug' for troubleshooting. Secrets are always redacted." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Log Format" Target="LOG_FORMAT" Default="json" Mode="" Description="[Log Output Format] - 'json' for structured logs (recommended for log aggregation), 'pretty' for human-readable console output in development." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== RATE LIMITING & QUEUE ==================== -->
  
  <Config Name="Rate Limit (Parts/Second)" Target="RATE_LIMIT_PARTS_PER_SECOND" Default="1.0" Mode="" Description="[AWS MPS Throttling] - Maximum message parts per second to send. AWS MPS limits vary by country and originator type. Default 1.0 is conservative. Increase cautiously based on your AWS limits." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Max Queue Size" Target="RATE_LIMIT_MAX_QUEUE_SIZE" Default="200" Mode="" Description="[Message Queue Depth] - Maximum number of messages to queue before rejecting new requests (HTTP 429). Prevents memory exhaustion." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Max Send Retries" Target="MAX_SEND_RETRIES" Default="5" Mode="" Description="[Retry on Throttle] - Number of times to retry sending a message after throttling errors. Uses exponential backoff (max 30s between retries)." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== MESSAGE CONFIGURATION ==================== -->
  
  <Config Name="History Retention" Target="HISTORY_RETENTION" Default="100" Mode="" Description="[Message History Size] - Number of sent messages to keep in history. Older messages are automatically pruned. Stored in /app/data/history.json." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Cache Duration (ms)" Target="CACHE_DURATION" Default="300000" Mode="" Description="[Originator Cache TTL] - How long to cache AWS phone numbers and sender IDs in milliseconds. Default 300000 = 5 minutes. Reduces AWS API calls." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== FEATURE FLAGS ==================== -->
  
  <Config Name="Enable Real Sends" Target="SENDS_ENABLED" Default="false" Mode="" Description="[Production Send Mode] - Set to 'true' to enable REAL SMS sends. Default 'false' for safety (all sends are simulated). Use DryRun endpoint for testing first." Type="Variable" Display="always" Required="false" Mask="false"/>
  
  <Config Name="Simulate Sends" Target="SENDS_SIMULATE" Default="true" Mode="" Description="[Simulation Mode] - When 'true', all sends return simulated MessageId without calling AWS (useful for testing). Override per-request with simulate:true in API payload." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== OPTIONAL SETTINGS ==================== -->
  
  <Config Name="Timezone" Target="TZ" Default="UTC" Mode="" Description="[Container Timezone] - Timezone for logs and timestamps (e.g., America/New_York, Europe/London, UTC). Uses IANA timezone database." Type="Variable" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Node Environment" Target="NODE_ENV" Default="production" Mode="" Description="[Runtime Mode] - 'production' for normal use (JSON logs), 'development' for verbose pretty logs. Affects log formatting and error verbosity." Type="Variable" Display="advanced" Required="false" Mask="false"/>

  <!-- ==================== WATCHTOWER AUTO-UPDATE ==================== -->
  
  <Config Name="Watchtower Enable" Target="com.centurylinklabs.watchtower.enable" Default="true" Mode="" Description="Enable Watchtower auto-updates for this container (requires Watchtower running)" Type="Label" Display="advanced" Required="false" Mask="false"/>
  
  <Config Name="Watchtower Monitor Only" Target="com.centurylinklabs.watchtower.monitor-only" Default="false" Mode="" Description="Monitor for updates but don't auto-apply (notification only)" Type="Label" Display="advanced" Required="false" Mask="false"/>
</Container>
